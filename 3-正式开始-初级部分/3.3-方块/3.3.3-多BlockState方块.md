# 多BlockState方块

Minecraft有普通的木箱子，为什么就没有铁箱子呢？这一节，笔者将以铁箱子为例，带领读者创建多BlockState方块。

## 什么是BlockState

`BlockState`是Minecraft 1.8引入的系统，用以替代原先标记方块状态使用的`Metadata`。顾名思义，`BlockState`就是方块状态。如熔炉的不同的朝向、红石灯的亮灭等，都是多`BlockState`的具体体现。

## Block与BlockState的关系

`Block`与`BlockState`的关系，**就好比`Item`与`ItemStack`的关系**。Minecraft中世界的方块，**就是以`BlockState`存储的**。`BlockState`与`Block`相比，多了xyz的坐标信息，**还多了`state`信息**。也就是上文所述的熔炉、红石灯等。

## 开始创建方块

### 创建基础方块

首先就是方块的类。具体的方法请参考**3.2.6章节**。

**`src/main/java/com/github/vvvbbbcz/modderguide/block/IronChest.java（部分）`**：

```java
public class IronChest extends Block {
	public IronChest() {
		super(Properties.create(Material.IRON));
	}
}
```

### 添加state

然后，就是添加`state`的阶段。在代码中叫`Property`。

```java
public static final DirectionProperty FACING = HorizontalBlock.HORIZONTAL_FACING;
```

`DirectionProperty`指的是朝向，**如果该state是布尔值（红石灯），则是`BooleanProperty`**。如果有更复杂的需求，则需要**自行创建相应的Enum**。

我们已经创建了方块状态，**但现在游戏并不认得我们的方块状态**，我们需要覆写`fillStateContainer()`方法。

```java
@Override
protected void fillStateContainer(StateContainer.Builder<Block, BlockState> builder) {
	builder.add(<your_states>);
	super.fillStateContainer(builder);
}
```

**同时，我们还要设置默认的BlockState。**

```java
public MetalChest() {
	super(Properties.create(Material.IRON));
	this.setDefaultState(this.stateContainer.getBaseState().with(FACING, Direction.NORTH));
}
```

### 一些不得不覆写的方法

**由于我们设置了有关方块朝向的state，因此需要覆写下面的方法。**

```java
public BlockState rotate(BlockState state, Rotation rot) {
	return state.with(FACING, rot.rotate(state.get(FACING)));
}

public BlockState mirror(BlockState state, Mirror mirrorIn) {
	return state.rotate(mirrorIn.toRotation(state.get(FACING)));
}
```

### 更改放置时的BlockState

但当我们放置方块时，**Minecraft默认放置的是刚刚设置的DefaultState**。而我们的目的是让方块正对着玩家放置，因此需要覆写`getStateForPlacement()`方法。

```java
public BlockState getStateForPlacement(BlockItemUseContext context) {
	return this.getDefaultState().with(FACING, context.getPlacementHorizontalFacing().getOpposite());
}
```

## 模型与材质

至此，我们方块的基础部分就完成了，接下来就是模型与材质。

首先就是blockstate的json文件。

**`src/main/resources/assets/modderguide/blockstates/iron_chest.json`**：

```json
{
  "variants": {
    // 表明当facing为north时，模型为modderguide:block/iron_chest。
    // 如果有其它state，那么这里的facing与其它state需要按字母表排序。
    "facing=north": { "model": "modderguide:block/iron_chest" },
    "facing=south": { "model": "modderguide:block/iron_chest", "y": 180 },
    "facing=west": { "model": "modderguide:block/iron_chest", "y": 270 },
    "facing=east": { "model": "modderguide:block/iron_chest", "y": 90 }
  }
}
```

对应的模型、材质等自然不用多说。